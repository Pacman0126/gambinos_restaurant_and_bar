{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Update Reservation</h2>

  <div class="row">
    <!-- Left: current details (read-only) -->
    <div class="col-md-5 mb-4">
      <div class="card">
        <div class="card-header">
          Current Reservation Details
        </div>
        <div class="card-body">
          <p><strong>Reservation ID:</strong> {{ reservation.id }}</p>

          {% if reservation.customer %}
            <p>
              <strong>Customer:</strong>
              {{ reservation.customer.first_name }} {{ reservation.customer.last_name }}
              <small class="text-muted d-block">({{ reservation.customer.email }})</small>
            </p>
          {% endif %}

          <p><strong>Date:</strong> {{ reservation.reservation_date|date:"D, M j, Y" }}</p>

          <p>
            <strong>Time:</strong>
            {{ reservation.time_range_pretty|default:"Not set" }}
            <small class="text-muted d-block">
              ({{ reservation.duration_hours }} hour{% if reservation.duration_hours != 1 %}s{% endif %})
            </small>
          </p>

          <p>
            <strong>Tables:</strong> {{ reservation.number_of_tables_required_by_patron }}
          </p>

          <p>
            <strong>Status:</strong>
            {% if reservation.status == 'active' or reservation.reservation_status %}
              Confirmed
            {% else %}
              Cancelled
            {% endif %}
          </p>

          <p>
            <strong>Created on:</strong>
            {{ reservation.created_at|date:"M d, Y H:i" }}
          </p>
          <p>
            <strong>Last updated:</strong>
            {{ reservation.updated_at|date:"M d, Y H:i" }}
          </p>
        </div>
      </div>
    </div>

    <!-- Right: edit form -->
    <div class="col-md-7 mb-4">
      <div class="card">
        <div class="card-header">
          Edit Reservation
        </div>
        <div class="card-body">
          <form method="post">
            {% csrf_token %}

            <!-- Duration (editable) -->
            <div class="mb-3">
              <label for="id_duration_hours" class="form-label">Duration (hours)</label>
              <input type="number" name="duration_hours" id="id_duration_hours" 
                     class="form-control" min="1" max="5" 
                     value="{{ form.duration_hours.value|default:reservation.duration_hours }}" required>
              {{ form.duration_hours.errors }}
            </div>

            <!-- Tables (editable) -->
            <div class="mb-3">
              <label for="id_number_of_tables_required_by_patron" class="form-label">Number of Tables</label>
              <input type="number" name="number_of_tables_required_by_patron" id="id_number_of_tables_required_by_patron" 
                     class="form-control" min="1" 
                     value="{{ form.number_of_tables_required_by_patron.value|default:reservation.number_of_tables_required_by_patron }}" required>
              {{ form.number_of_tables_required_by_patron.errors }}
            </div>

            {% comment %} <!-- Number of Days (new field - harmonized with create pages) -->
            <div class="mb-3">
              <label for="id_series_days" class="form-label">Number of Days</label>
              <input type="number" name="series_days" id="id_series_days" 
                     class="form-control" min="1" max="30" 
                     value="{{ series_days }}" required>
              <small class="form-text text-muted">Increase to add consecutive days; decrease to remove (with availability check).</small>
            </div> {% endcomment %}

            <!-- Optional notes (if you have it) -->
            {% if form.notes %}
              <div class="mb-3">
                {{ form.notes|crispy }}
              </div>
            {% endif %}
            <input type="hidden" name="next" value="{{ next }}">
            <div class="mt-4 text-end">
              <a href="{{ next }}" class="btn btn-outline-secondary">
                Cancel
              </a>
              <button type="submit" class="btn btn-primary ms-2">
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}